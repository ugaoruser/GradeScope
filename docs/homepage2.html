<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GradeTracker â€” Teacher Home</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pacifico&display=swap" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.5.0/remixicon.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="chatbot.js" defer></script>
  <script src="config.js" defer></script>
  <script src="chart.js" defer></script>
  <script src="app.js" defer></script>
</head>
 <body class="homepage2">
  <div class="sidebar" data-shared="sidebar">
    <div class="top">
      <ul class="nav">
        <li class="active" id="navHomeT">Home</li>
        <li id="navSettingsT">Settings</li>
        <li id="aboutBtn">About</li>
      </ul>
    </div>
    <div class="bottom">
      <div class="app-version">Grade Tracker v1.0</div>
    </div>
  </div>
  <div class="main">
    <header class="header" data-shared="header">
      <div class="header-title">Welcome</div>
      <div class="account-menu">
        <button class="account-btn" id="accountBtnT">
          <span id="accountInitial">T</span>
        </button>
        <div class="account-dropdown" id="accountDropdown" aria-hidden="true">
          <div class="account-info">
            <div id="userFullName">User Name</div>
            <div id="userEmail"></div>
          </div>
          <button id="logoutBtnT">Log Out</button>
        </div>
      </div>
    </header>

    <div class="header-actions" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h2 style="margin:0;">Classes</h2>
      <button class="add-class-btn" id="createClassBtn">+ Create Class</button>
    </div>

    <div class="classroom-tabs" id="classroomTabs">Loading...</div>
    
    <!-- Auto-Generated Class System (Teachers Only) -->
    <div id="autoGeneratedSection" style="margin-top: 2rem; display: none;">
      <h3 style="margin-bottom: 1rem; color: var(--primary); font-weight: 700;">ðŸ¤– Auto-Generated Classes</h3>
      <div id="autoClassContainer" class="class-container"></div>
    </div>

    <!-- Chatbot Toggle Button -->
    <button id="chatbotToggle" style="position: fixed; right: 24px; bottom: 24px; width: 56px; height: 56px; border-radius: 50%; background:#1976d2; color:#fff; border:none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor:pointer; font-size:24px;">ðŸ’¬</button>
    <!-- Chatbot Sidebar -->
    <div id="chatbotSidebar" style="position: fixed; right: -360px; top: 0; width: 360px; height: 100%; background: #fff; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: right 0.3s ease; z-index: 1000; display:flex; flex-direction:column;">
      <div style="padding: 12px 16px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:600;">Assistant</div>
        <button id="closeChatbot" style="background:none; border:none; font-size:20px; cursor:pointer;">&times;</button>
      </div>
      <div id="chatLog" style="flex:1; padding: 12px; overflow:auto;">
        <div style="color:#666;">I can help you draft comments and estimate student progress. Ask me something like "Create a comment for Maria in Algebra, score 82" or "Average of 78, 85, 90".</div>
      </div>
      <div style="padding: 12px; border-top:1px solid #eee; display:flex; gap:8px;">
        <input id="chatInput" placeholder="Type a message..." style="flex:1; padding:10px; border:1px solid #ddd; border-radius:6px;">
        <button id="sendChat" style="padding:10px 14px; background:#1976d2; color:#fff; border:none; border-radius:6px; cursor:pointer;">Send</button>
      </div>
    </div>
  </div>
  
  <!-- About Modal (no profile info) -->
<div id="aboutModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1" style="display:none;">
    <div class="modal-panel">
      <div class="modal-header">
        <div class="modal-title">About GradeTracker</div>
        <button class="modal-close" id="closeAboutBtnT" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <p>This website acts as a Grade Tracker to track the quizzes and scores of students in a more faster way. It can be used by students, teachers, and parents.</p>
        <p><strong>Version:</strong> V1.0</p>
        <p><strong>Developed by:</strong> Group 4 Practical Research Group [12-Lovelace]</p>
        <p><strong>Main Dev:</strong> Jack Dylan Gallentes</p>
      </div>
    </div>
  </div>
  
  <!-- Add Class Modal -->
  <div id="addClassModal" style="display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
    <div style="background-color: #fff; margin: 10% auto; padding: 24px; border-radius: 8px; width: 80%; max-width: 500px; box-shadow: 0 4px 16px rgba(0,0,0,0.2);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <div style="font-size: 1.5em; font-weight: bold;">Create Class</div>
        <button style="font-size: 1.5em; cursor: pointer; background: none; border: none;" id="closeAddClassX">&times;</button>
      </div>
      <div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: bold;">Name of Class</label>
          <input type="text" id="className" placeholder="Enter class name" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em;">
        </div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: bold;">Grade Level</label>
          <input type="text" id="gradeLevel" placeholder="e.g., Grade 10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em;">
        </div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: bold;">Section</label>
          <input type="text" id="section" placeholder="Enter section" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em;">
        </div>
        <div class="modal-actions">
          <button id="cancelCreate" class="btn-muted">Cancel</button>
          <button id="confirmCreate" class="btn-primary">Create</button>
        </div>
      </div>
    </div>
  </div>

<script>
// Collaborate with the in-app Agent (global singleton from chatbot.js)
document.addEventListener('DOMContentLoaded', function() {
  const agent = window.Agent; // FeedbackChatbot instance exposed by chatbot.js
  const chatInput = document.getElementById('chatInput');
  const sendButton = document.getElementById('sendChat');
  const chatLog = document.getElementById('chatLog');

  if (sendButton && chatInput && chatLog) {
    sendButton.addEventListener('click', handleChat);
    chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChat(); });
  }

  function handleChat() {
    const message = chatInput.value.trim();
    if (!message) return;
    addMessage(message, 'user');
    chatInput.value = '';
    setTimeout(() => { addMessage(processMessage(message), 'bot'); }, 300);
  }

  function addMessage(text, sender) {
    const div = document.createElement('div');
    div.style.marginBottom = '8px'; div.style.padding = '8px 12px'; div.style.borderRadius = '8px'; div.style.maxWidth = '80%';
    if (sender === 'user') { div.style.background = '#3b82f6'; div.style.color = 'white'; div.style.marginLeft = 'auto'; }
    else { div.style.background = '#f3f4f6'; div.style.color = '#374151'; }
    div.textContent = text; chatLog.appendChild(div); chatLog.scrollTop = chatLog.scrollHeight;
  }

  function processMessage(message) {
    const lower = message.toLowerCase();
    // Average calculation
    if (lower.includes('average')) {
      const nums = message.match(/\d+(?:\.\d+)?/g);
      if (nums) { const avg = nums.map(Number).reduce((a,b)=>a+b,0) / nums.length; return `The average is ${avg.toFixed(1)}.`; }
    }
    // Comment generation via Agent
    if (agent && (lower.includes('comment') || lower.includes('feedback'))) {
      const nameMatch = message.match(/for\s+([A-Za-z][\w-]*)/i);
      const scoreMatch = message.match(/(\d{1,3})(?!.*\d)/);
      const topicMatch = message.match(/in\s+([^,]+)$/i);
      const name = nameMatch ? nameMatch[1] : 'the student';
      const score = scoreMatch ? Math.min(100, parseInt(scoreMatch[1], 10)) : 85;
      const topic = topicMatch ? topicMatch[1].trim() : 'this subject';
      const subjectEl = document.getElementById('selected-subject-label') || document.getElementById('subjectTitle');
      const subject = subjectEl ? subjectEl.textContent : 'General';
      try{
        const res = agent.generateCompleteFeedback(score, subject, topic, name);
        const suggestion = (res.suggestions && res.suggestions[0]) ? `\n\nSuggestion: ${res.suggestions[0]}` : '';
        return `${res.feedback}${suggestion}`;
      }catch{ /* fallback */ }
    }
    return "I can help with: average calculations (e.g., 'Average of 85, 90, 78') and generating comments (e.g., 'Comment for Ana in Math, score 88').";
  }
});
</script>
</body>
</html>
